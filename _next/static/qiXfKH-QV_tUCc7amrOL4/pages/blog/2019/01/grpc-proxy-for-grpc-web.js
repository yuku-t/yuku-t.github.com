(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"7ljp":function(e,t,a){"use strict";a.d(t,"a",(function(){return f}));var r=a("q1tI"),n=a.n(r);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},c=Object.keys(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=n.a.createContext({}),p=function(e){var t=n.a.useContext(s),a=t;return e&&(a="function"===typeof e?e(t):i(i({},t),e)),a},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=n.a.forwardRef((function(e,t){var a=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=p(a),b=r,f=u["".concat(o,".").concat(b)]||u[b]||m[b]||c;return a?n.a.createElement(f,i(i({ref:t},s),{},{components:a})):n.a.createElement(f,i({ref:t},s))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"===typeof e||r){var c=a.length,o=new Array(c);o[0]=b;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"===typeof e?e:r,o[1]=i;for(var s=2;s<c;s++)o[s]=a[s];return n.a.createElement.apply(null,o)}return n.a.createElement.apply(null,a)}b.displayName="MDXCreateElement"},"83p3":function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2019/01/grpc-proxy-for-grpc-web",function(){return a("h37B")}])},Ff2n:function(e,t,a){"use strict";function r(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},c=Object.keys(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)a=c[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}a.d(t,"a",(function(){return r}))},Yp5c:function(e,t,a){"use strict";a.d(t,"a",(function(){return v})),a.d(t,"b",(function(){return P}));var r=a("q1tI"),n=a.n(r),c=a("8Kt/"),o=a.n(c),i=a("YFqc"),l=a.n(i),s=a("nOHt"),p=a("TSYQ"),u=a.n(p),m=a("wd/R"),b=a.n(m),f=a("IP2g"),h=a("he5r"),d=n.a.createElement,g=function(e){return d("aside",{className:u()("widget mb-4",e.className)},d("h1",{className:"title font-weight-bold"},e.title),e.children)},y=n.a.createElement,O=function(e){return e||"https://yuku.takahashi.coffee".concat(h.a)},w=Object(s.withRouter)((function(e){return y("div",{className:"blogpage container"},y(o.a,null,y("title",null,e.meta.title," - ",h.c),y("meta",{name:"description",content:e.meta.description}),y("meta",{name:"twitter:card",content:"summary"}),y("meta",{name:"twitter:creator",content:"@yuku_t"}),y("meta",{property:"fb:app_id",content:h.b}),y("meta",{property:"og:title",content:"".concat(e.meta.title," - ").concat(h.c)}),y("meta",{property:"og:type",content:"article"}),y("meta",{property:"og:url",content:"https://yuku.takahashi.coffee".concat(e.router.pathname)}),y("meta",{property:"og:image",content:O()}),y("meta",{property:"og:description",content:e.meta.description}),y("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/prism/1.15.0/themes/prism.min.css"}),y("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css"})),y("div",{className:"row"},y("main",{className:u()("col-xl-8",e.className)},y("article",{itemScope:!0,itemType:"http://schema.org/BlogPosting"},y("meta",{itemProp:"author",content:"Yuku Takahashi"}),y("meta",{itemProp:"datePublished",content:e.meta.publishedAt}),e.meta.modifiedAt&&y("meta",{itemProp:"dateModified",content:e.meta.modifiedAt}),y("meta",{itemProp:"image",content:O()}),y("header",{className:"mb-4 header"},y("h1",{className:"headline",itemProp:"headline"},e.meta.title),y("ul",{className:"list-inline text-dark font-weight-light"},y("li",{className:"list-inline-item"},y("span",{className:"ml-1"},b()(e.meta.publishedAt).format("YYYY-MM-DD HH:mm"))),y("li",{className:"list-inline-item"},e.meta.tags.map((function(e,t){return[t>0?",":null,y("span",{key:t,className:"ml-1"},"#",e)]}))))),y("section",{className:"mb-4 body",itemProp:"articleBody"},e.children))),y("div",{className:"col-xl-4"},y("div",{className:"pl-xl-2"},y(g,{title:"About Me"},y("div",null,y("img",{src:h.a,alt:"avatar",className:"avatar rounded-circle mb-4 mx-auto d-block"}),y("p",null,"Software Engineer at FLYWHEEL. Working mainly on recommendation systems in these days. Ex-Qiita CTO.",y(l.a,{href:"/about"},y("a",{href:"/about",style:{marginLeft:"4px"}},"Read more")),"."))),y(g,{title:"Follow"},y("ul",{className:"list-inline icons"},y("li",{className:"list-inline-item"},y("a",{href:"https://twitter.com/yuku_t"},y("span",{className:"fa-stack fa-lg"},y(f.a,{icon:"circle",className:"fa-stack-2x"}),y(f.a,{icon:["fab","twitter"],inverse:!0,className:"fa-stack-1x"})))),y("li",{className:"list-inline-item"},y("a",{href:"https://github.com/yuku"},y("span",{className:"fa-stack fa-lg"},y(f.a,{icon:"circle",className:"fa-stack-2x"}),y(f.a,{icon:["fab","github"],inverse:!0,className:"fa-stack-1x"})))),y("li",{className:"list-inline-item"},y("a",{href:"/static/rss-feed.xml"},y("span",{className:"fa-stack fa-lg"},y(f.a,{icon:"circle",className:"fa-stack-2x"}),y(f.a,{icon:"rss",inverse:!0,className:"fa-stack-1x"}))))))))))})),j=n.a.createElement,v=function(e){var t=e.meta,a=e.children;return Object(r.useEffect)((function(){if(t.loadTwitterWidget){var e=document.createElement("script");e.async=!0,e.src="https://platform.twitter.com/widgets.js",e.charset="utf-8",document.body.appendChild(e)}}),[]),j(w,{className:"mdx",meta:t},a)},T=n.a.createElement,P=function(e){return T(w,{className:"notebook",meta:e.meta},e.children)}},h37B:function(e,t,a){"use strict";a.r(t);var r=a("o0o1"),n=a.n(r),c=a("HaE+"),o=a("q1tI"),i=a.n(o),l=a("Yp5c"),s=a("wx14"),p=a("Ff2n"),u=a("7ljp"),m=(i.a.createElement,{}),b="wrapper";function f(e){var t=e.components,a=Object(p.a)(e,["components"]);return Object(u.a)(b,Object(s.a)({},m,a,{components:t,mdxType:"MDXLayout"}),Object(u.a)("p",null,"When I read the gRPC-Web documentation, I was surprised to see ",Object(u.a)("a",Object(s.a)({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," used without any explanation:"),Object(u.a)("blockquote",null,Object(u.a)("p",{parentName:"blockquote"},"In this example, we will use the ",Object(u.a)("a",Object(s.a)({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," proxy to forward the gRPC browser request to the backend server. - ",Object(u.a)("a",Object(s.a)({parentName:"p"},{href:"https://grpc.io/docs/tutorials/basic/web.html"}),"gRPC Basics - Web"))),Object(u.a)("p",null,"gRPC uses HTTP2. Since modern browsers are able to communicate over HTTP2, I don't see the need to set up a proxy if I support only such browsers. Why do I need a proxy like Envoy nonetheless?"),Object(u.a)("h2",null,"Browser Restriction"),Object(u.a)("p",null,"There is a hint in the documentation describing the gRPC-Web protocol:"),Object(u.a)("blockquote",null,Object(u.a)("p",{parentName:"blockquote"},"decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers - ",Object(u.a)("a",Object(s.a)({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md at master \xb7 grpc/grpc"))),Object(u.a)("p",null,"In short:"),Object(u.a)("ul",null,Object(u.a)("li",{parentName:"ul"},"JavaScript running in the browser does not provide full control over HTTP2."),Object(u.a)("li",{parentName:"ul"},"The gRPC protocol uses features of HTTP/2 that cannot be controlled by JavaScript."),Object(u.a)("li",{parentName:"ul"},"So that a proxy is required.")),Object(u.a)("p",null,"And I think the restriction will never be removed."),Object(u.a)("h2",null,"Why Restricted?"),Object(u.a)("p",null,"Why am I so sure that browser will keep the restriction?"),Object(u.a)("p",null,"The reason can be explained by considering the position of HTTP2 in the public Web. HTTP/1.1 has been used on the Web for a long time. So you can expect your web servers to be able to communicate over HTTP/1.1. However, it is not clear whether they can communicate over HTTP2. Therefore, a browser uses HTTP2 if it can communicate with a web server over HTTP2, but otherwise, it will fall back to HTTP/1.1."),Object(u.a)("p",null,"Also, because of the concept of layered architecture, Web application must not know whether HTTP2 or HTTP/1.1 is used under the hood. This means HTTP/1.1 and HTTP2 must be able to be handled transparently so that browser will never provide a way to control a feature only available in HTTP2 by JavaScript."),Object(u.a)("p",null,"gRPC uses the such HTTP2-only feature."),Object(u.a)("h2",null,"References"),Object(u.a)("ul",null,Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",Object(s.a)({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd8/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md \xb7 grpc/grpc")),Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",Object(s.a)({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-HTTP2.md"}),"grpc/PROTOCOL-HTTP2.md \xb7 grpc/grpc")),Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",Object(s.a)({parentName:"li"},{href:"https://github.com/grpc/grpc-web/issues/347"}),"Why is envoy proxy required? \xb7 Issue #347 \xb7 grpc/grpc-web")),Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",Object(s.a)({parentName:"li"},{href:"https://github.com/k2wanko/gae-grpc-web"}),"k2wanko/gae-grpc-web: Example: gRPC Web on Google App Engine / Go"))))}f.isMDXComponent=!0;var h=i.a.createElement,d=function(e){var t=e.meta;return h(l.a,{meta:t},h(f,null))};d.getInitialProps=Object(c.a)(n.a.mark((function e(){var t,r;return n.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a("n1xW"),r=t.entries,e.abrupt("return",{meta:r["blog/2019/01/grpc-proxy-for-grpc-web"]});case 2:case"end":return e.stop()}}),e)})));t.default=d},wx14:function(e,t,a){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}a.d(t,"a",(function(){return r}))}},[["83p3",0,1,4,2,5,3]]]);