(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"83p3":function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2019/01/grpc-proxy-for-grpc-web",function(){return a("h37B")}])},h37B:function(e,t,a){"use strict";a.r(t);var r=a("o0o1"),o=a.n(r),n=a("HaE+"),c=a("q1tI"),p=a.n(c),b=a("Yp5c"),l=a("wx14"),i=a("Ff2n"),s=a("7ljp"),u=(p.a.createElement,{}),h="wrapper";function d(e){var t=e.components,a=Object(i.a)(e,["components"]);return Object(s.a)(h,Object(l.a)({},u,a,{components:t,mdxType:"MDXLayout"}),Object(s.a)("p",null,"When I read the gRPC-Web documentation, I was surprised to see ",Object(s.a)("a",Object(l.a)({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," used without any explanation:"),Object(s.a)("blockquote",null,Object(s.a)("p",{parentName:"blockquote"},"In this example, we will use the ",Object(s.a)("a",Object(l.a)({parentName:"p"},{href:"https://www.envoyproxy.io/"}),"Envoy")," proxy to forward the gRPC browser request to the backend server. - ",Object(s.a)("a",Object(l.a)({parentName:"p"},{href:"https://grpc.io/docs/tutorials/basic/web.html"}),"gRPC Basics - Web"))),Object(s.a)("p",null,"gRPC uses HTTP2. Since modern browsers are able to communicate over HTTP2, I don't see the need to set up a proxy if I support only such browsers. Why do I need a proxy like Envoy nonetheless?"),Object(s.a)("h2",null,"Browser Restriction"),Object(s.a)("p",null,"There is a hint in the documentation describing the gRPC-Web protocol:"),Object(s.a)("blockquote",null,Object(s.a)("p",{parentName:"blockquote"},"decouple from HTTP/2 framing which is not, and will never, be directly exposed by browsers - ",Object(s.a)("a",Object(l.a)({parentName:"p"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md at master \xb7 grpc/grpc"))),Object(s.a)("p",null,"In short:"),Object(s.a)("ul",null,Object(s.a)("li",{parentName:"ul"},"JavaScript running in the browser does not provide full control over HTTP2."),Object(s.a)("li",{parentName:"ul"},"The gRPC protocol uses features of HTTP/2 that cannot be controlled by JavaScript."),Object(s.a)("li",{parentName:"ul"},"So that a proxy is required.")),Object(s.a)("p",null,"And I think the restriction will never be removed."),Object(s.a)("h2",null,"Why Restricted?"),Object(s.a)("p",null,"Why am I so sure that browser will keep the restriction?"),Object(s.a)("p",null,"The reason can be explained by considering the position of HTTP2 in the public Web. HTTP/1.1 has been used on the Web for a long time. So you can expect your web servers to be able to communicate over HTTP/1.1. However, it is not clear whether they can communicate over HTTP2. Therefore, a browser uses HTTP2 if it can communicate with a web server over HTTP2, but otherwise, it will fall back to HTTP/1.1."),Object(s.a)("p",null,"Also, because of the concept of layered architecture, Web application must not know whether HTTP2 or HTTP/1.1 is used under the hood. This means HTTP/1.1 and HTTP2 must be able to be handled transparently so that browser will never provide a way to control a feature only available in HTTP2 by JavaScript."),Object(s.a)("p",null,"gRPC uses the such HTTP2-only feature."),Object(s.a)("h2",null,"References"),Object(s.a)("ul",null,Object(s.a)("li",{parentName:"ul"},Object(s.a)("a",Object(l.a)({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd8/doc/PROTOCOL-WEB.md"}),"grpc/PROTOCOL-WEB.md \xb7 grpc/grpc")),Object(s.a)("li",{parentName:"ul"},Object(s.a)("a",Object(l.a)({parentName:"li"},{href:"https://github.com/grpc/grpc/blob/f0bfcd864c7a2395ad82ff9db8e39d0c51d49ee0/doc/PROTOCOL-HTTP2.md"}),"grpc/PROTOCOL-HTTP2.md \xb7 grpc/grpc")),Object(s.a)("li",{parentName:"ul"},Object(s.a)("a",Object(l.a)({parentName:"li"},{href:"https://github.com/grpc/grpc-web/issues/347"}),"Why is envoy proxy required? \xb7 Issue #347 \xb7 grpc/grpc-web")),Object(s.a)("li",{parentName:"ul"},Object(s.a)("a",Object(l.a)({parentName:"li"},{href:"https://github.com/k2wanko/gae-grpc-web"}),"k2wanko/gae-grpc-web: Example: gRPC Web on Google App Engine / Go"))))}d.isMDXComponent=!0;var O=p.a.createElement,m=function(e){var t=e.meta;return O(b.a,{meta:t},O(d,null))};m.getInitialProps=Object(n.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a("n1xW"),r=t.entries,e.abrupt("return",{meta:r["blog/2019/01/grpc-proxy-for-grpc-web"]});case 2:case"end":return e.stop()}}),e)})));t.default=m}},[["83p3",0,1,4,2,3,5,6]]]);