(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{386:function(e,n,t){__NEXT_REGISTER_PAGE("/blog/2019/01/google-cloud-sdk-in-docker",function(){return e.exports=t(404),{page:e.exports.default}})},404:function(e,n,t){"use strict";t.r(n);var a=t(3),o=t.n(a),r=t(1),c=t.n(r),l=t(5),u=t(0);function p(){return(p=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}function i(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s={},m="wrapper";function b(e){var n=e.components,t=i(e,["components"]);return Object(u.a)(m,p({},s,t,{components:n,mdxType:"MDXLayout"}),Object(u.a)("p",null,"GCP を使う際に避けて通れないのが ",Object(u.a)("a",p({parentName:"p"},{href:"https://cloud.google.com/sdk/"}),"Google Cloud SDK")," ですが、システムの Python 2.7 を期待しているのが微妙だったり、独自に状態を保持しているため気がつくとこの PC でだけデプロイできるみたいなことになりがちです。そもそもシステムに不用意にツールをインストールしたくないという気持ちの問題もあります。"),Object(u.a)("p",null,"そこで ",Object(u.a)("a",p({parentName:"p"},{href:"https://hub.docker.com/r/google/cloud-sdk/"}),"google/cloud-sdk")," という Google 公式の Docker イメージをローカル環境でも使ってみることにしました。"),Object(u.a)("h2",null,"Docker イメージを用意する"),Object(u.a)("p",null,"google/cloud-sdk は大きく分けて 3 種類存在しています:"),Object(u.a)("ul",null,Object(u.a)("li",{parentName:"ul"},Object(u.a)("inlineCode",{parentName:"li"},"latest"),", ",Object(u.a)("inlineCode",{parentName:"li"},"VERSION")," - Debian ベースで",Object(u.a)("a",p({parentName:"li"},{href:"https://cloud.google.com/sdk/downloads#apt-get"}),"すべてのコンポーネント"),"がインストールされた大きいイメージ"),Object(u.a)("li",{parentName:"ul"},Object(u.a)("inlineCode",{parentName:"li"},"slim"),", ",Object(u.a)("inlineCode",{parentName:"li"},"VERSION-slim")," - Debian ベースでコンポーネントがインストールされていない"),Object(u.a)("li",{parentName:"ul"},Object(u.a)("inlineCode",{parentName:"li"},"alpine"),", ",Object(u.a)("inlineCode",{parentName:"li"},"VERSION-alpine")," - Alpine ベースでコンポーネントがインストールされていない")),Object(u.a)("p",null,"Google AppEngine を使いたかった & AppEngine のコンポーネントは標準でついてくるので、今回はサイズが一番小さい ",Object(u.a)("inlineCode",{parentName:"p"},"alpine")," にしました:"),Object(u.a)("pre",{className:"language-bash"},Object(u.a)("code",p({parentName:"pre"},{className:"language-bash"}),"docker pull google/cloud-sdk:alpine\n")),Object(u.a)("p",null,"インストールされていたツールは以下の通りです。なので ",Object(u.a)("inlineCode",{parentName:"p"},"229.0.0-alpine")," でも同じイメージを使うことができるはずです。"),Object(u.a)("pre",{className:"language-bash"},Object(u.a)("code",p({parentName:"pre"},{className:"language-bash"}),"docker run -it --rm google/cloud-sdk:alpine gcloud version\n",Object(u.a)("span",p({parentName:"code"},{className:"token comment"}),"# Google Cloud SDK 229.0.0"),"\n",Object(u.a)("span",p({parentName:"code"},{className:"token comment"}),"# bq 2.0.39"),"\n",Object(u.a)("span",p({parentName:"code"},{className:"token comment"}),"# core 2019.01.04"),"\n",Object(u.a)("span",p({parentName:"code"},{className:"token comment"}),"# gsutil 4.35"),"\n")),Object(u.a)("h2",null,"認証する"),Object(u.a)("p",null,"認証情報を永続化するために ",Object(u.a)("inlineCode",{parentName:"p"},"--name")," オプションを使います"),Object(u.a)("pre",{className:"language-bash"},Object(u.a)("code",p({parentName:"pre"},{className:"language-bash"}),"docker run -it --name gcloud-config ",Object(u.a)("span",p({parentName:"code"},{className:"token punctuation"}),"\\"),"\n    google/cloud-sdk:alpine gcloud auth login\n")),Object(u.a)("p",null,"表示された URL をブラウザにコピペして指示に従って操作していき、最終的に画面に表示された verification code を今度はターミナルにコピペすれば認証完了です。"),Object(u.a)("h2",null,"SDK を使う"),Object(u.a)("p",null,Object(u.a)("inlineCode",{parentName:"p"},"--volumes-from gcloud-config")," を指定することで先程認証を行った volume をマウントすることができます。"),Object(u.a)("pre",{className:"language-bash"},Object(u.a)("code",p({parentName:"pre"},{className:"language-bash"}),"docker run --rm --volumes-from gcloud-config ",Object(u.a)("span",p({parentName:"code"},{className:"token punctuation"}),"\\"),"\n    google/cloud-sdk:alpine gcloud config list\n")),Object(u.a)("p",null,"余計な container を残さないように ",Object(u.a)("inlineCode",{parentName:"p"},"--rm")," をつけつつ、今後はすべてこの volume を使ってすべての情報をコマンドラインオプションで指定することにします。 例えば Google AppEngine のバージョン一覧を表示したい場合は:"),Object(u.a)("pre",{className:"language-bash"},Object(u.a)("code",p({parentName:"pre"},{className:"language-bash"}),"docker run --rm --volumes-from gcloud-config ",Object(u.a)("span",p({parentName:"code"},{className:"token punctuation"}),"\\"),"\n    google/cloud-sdk:alpine gcloud versions list ",Object(u.a)("span",p({parentName:"code"},{className:"token punctuation"}),"\\"),"\n    --project YOUR_RPOJECT_NAME\n")),Object(u.a)("h2",null,"参考"),Object(u.a)("ul",null,Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",p({parentName:"li"},{href:"https://cloud.google.com/sdk/docs/quickstart-mac-os-x?hl=ja"}),"Mac OS X 用のクイックスタート  |  Cloud SDK のドキュメント  |  Google Cloud")),Object(u.a)("li",{parentName:"ul"},Object(u.a)("a",p({parentName:"li"},{href:"https://hub.docker.com/r/google/cloud-sdk/"}),"google/cloud-sdk - Docker Hub"))))}function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,n,t,a,o,r,c){try{var l=e[r](c),u=l.value}catch(e){return void t(e)}l.done?n(u):Promise.resolve(u).then(a,o)}function f(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function O(e,n){return!n||"object"!==d(n)&&"function"!=typeof n?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):n}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function N(e,n){return(N=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}b.isMDXComponent=!0,t.d(n,"default",function(){return h});var h=function(e){function n(){return function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),O(this,j(n).apply(this,arguments))}var a,r,u;return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&N(e,n)}(n,c.a.Component),a=n,r=[{key:"render",value:function(){return c.a.createElement(l.a,{meta:this.props.meta},c.a.createElement(b,null))}}],u=[{key:"getInitialProps",value:function(){var e,n=(e=o.a.mark(function e(){var n,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t(20),a=n.entries,e.abrupt("return",{meta:a["blog/2019/01/google-cloud-sdk-in-docker"]});case 2:case"end":return e.stop()}},e)}),function(){var n=this,t=arguments;return new Promise(function(a,o){var r=e.apply(n,t);function c(e){g(r,a,o,c,l,"next",e)}function l(e){g(r,a,o,c,l,"throw",e)}c(void 0)})});return function(){return n.apply(this,arguments)}}()}],r&&f(a.prototype,r),u&&f(a,u),n}()}},[[386,1,0,2]]]);